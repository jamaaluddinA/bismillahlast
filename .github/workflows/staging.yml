name: ğŸš€ Deploy to Staging

on:
  push:
    branches: [ staging ]
  pull_request:
    branches: [ staging ]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ›ï¸ Checkout Repository
        uses: actions/checkout@v4
      
      - name: ğŸ¯ Setup Flutter
        uses: subosito/flutter-action@v2
        with:
          flutter-version: '3.38.5'
          
      - name: ğŸ“¦ Install Dependencies
        run: flutter pub get
      
      - name: ğŸ” Analyze Code
        run: flutter analyze || true
      
      - name: ğŸŒ Build Web App
        run: |
            flutter config --enable-web
            flutter build web --release   
      
      - name: ğŸš€ Deploy to Netlify Staging
        uses: nwtgck/actions-netlify@v2.0
        with:
          publish-dir: './build/web'
          production-branch: staging
          deploy-message: "Staging Deploy: ${{ github.sha }}"
        env:
          NETLIFY_AUTH_TOKEN: ${{ secrets.NETLIFY_AUTH_TOKEN }}
          NETLIFY_SITE_ID: ${{ secrets.NETLIFY_SITE_ID_STAGING }}
      
      - name: âœ… Verify Deployment
        run: |
          echo "âœ… STAGING DEPLOYMENT SUCCESS!"
          echo "ğŸ”— URL: https://shopping-app-staging.netlify.app"
          echo "ğŸ“ Commit: ${{ github.sha }}"